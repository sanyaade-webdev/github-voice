(function(a){a.fn.githubVoice=function(b,c,d){var e=a.fn.githubVoice,d=a.extend(!0,{},e.defaults,d||{}),e=d.setup||e.base;d.path=b+"/"+c;for(property in e)for(var b=e[property],c=0,f=b.length;c<f;c++)b[c].call(this,d);return this.trigger("github-voice-initialize")};a.fn.githubVoice.base={initialize:[function(){this.bind("github-voice-initialize",function(){a(this).trigger("github-voice-bindEventListeners")})}],bindEventListeners:[function(b){var c="https://api.github.com/repos/"+b.path+"/issues";
this.bind("github-voice-bindEventListeners",function(){var d=a(this);d.click(function(){var e=d.data("cache");b.overlay&&d.trigger("github-voice-createOverlay");d.trigger("github-voice-createElement").trigger("github-voice-updatePosition");e?d.trigger("github-voice-update",[e]):a.getJSON(c+"?callback=?",b.query,function(a){a=a.data;d.data("cache",a).trigger("github-voice-update",[a])});return!1})})}],createElement:[function(b){this.bind("github-voice-createElement",function(){var c=b.text;a("body").append(b.html);
a("#github-voice").find("p.description").html(c.description).end().find("li.loading").html(c.loading).end().find("p.call-to-action a").html(c.callToAction).attr("href","http://github.com/"+b.path+"/issues");a("#github-voice-wrapper .close").click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],createOverlay:[function(){this.bind("github-voice-createOverlay",function(){a("body").append('<div id="github-voice-overlay"></div>').find("#github-voice-overlay").css({width:a(window).width(),
height:a(document).height(),opacity:0.75}).click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],update:[function(b){this.bind("github-voice-update",function(c,d){var e=a("#github-voice ol").empty(),f;a.each(d,function(d,c){if(b.filter&&(f=!0,a.each(b.filter,function(a,b){if(!c[a].match(b))return f=!1}),!f))return;e.append('<li><p class="votes"><em>'+c.comments+'</em> comments</p><h3><a href="http://github.com/'+b.path+"/issues#issue/"+c.number+'">'+c.title+"</a></h3></li>")});
a("#github-voice p.call-to-action a").append("<span> ("+d.length+" ideas)</span>");a(this).trigger("github-voice-updatePosition")})}],updatePosition:[function(){this.bind("github-voice-updatePosition",function(){var b=a("#github-voice-wrapper");b.css("margin-top",-1*(b.height()/2))})}]};a.fn.githubVoice.defaults={overlay:!0,filter:null,query:{sort:"comments",per_page:5},text:{loading:"Loading...",description:"We've setup a feedback forum so you can tell us what's on your mind. Please go there and be heard!",
callToAction:"&raquo; Go to our Feedback Forum"},html:'<div id="github-voice-wrapper"><div class="close" /><h1>Feedback</h1><div id="github-voice"><p class="description"></p><ol><li class="loading"></li></ol><p class="call-to-action"><a href="#"></a></p></div></div>'}})(jQuery);
