(function(a){a.fn.githubVoice=function(b,e,c){c=a.extend(!0,{},a.fn.githubVoice.defaults,c||{});c.path=b+"/"+e;return this.setupExtras(c.setup||a.fn.githubVoice.base,c).trigger("github-voice-initialize")};a.fn.githubVoice.base={initialize:[function(){this.bind("github-voice-initialize",function(){a(this).trigger("github-voice-bindEventListeners")})}],bindEventListeners:[function(b){var e="http://github.com/api/v2/json/issues/list/"+b.path+"/open";this.bind("github-voice-bindEventListeners",function(){var c=
a(this);c.click(function(){var d=c.data("cache");b.overlay&&c.trigger("github-voice-createOverlay");c.trigger("github-voice-createElement").trigger("github-voice-updatePosition");d?c.trigger("github-voice-update",[d]):a.getJSON(e+"?callback=?",function(a){c.data("cache",a).trigger("github-voice-update",[a])});return!1})})}],createElement:[function(b){this.bind("github-voice-createElement",function(){var e=b.text;a("body").append(b.html);a("#github-voice").find("p.description").html(e.description).end().find("li.loading").html(e.loading).end().find("p.call-to-action a").html(e.callToAction).attr("href",
"http://github.com/"+b.path+"/issues");a("#github-voice-wrapper .close").click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],createOverlay:[function(){this.bind("github-voice-createOverlay",function(){a("body").append('<div id="github-voice-overlay"></div>').find("#github-voice-overlay").css({width:a(window).width(),height:a(document).height(),opacity:0.75}).click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],update:[function(b){this.bind("github-voice-update",
function(e,c){var d=b.sort,g=a("#github-voice ol").empty(),h=0,f;c.issues.sort(a.isFunction(d)?d:function(a,b){return a[d]<b[d]?1:a[d]>b[d]?-1:0});a.each(c.issues,function(c,d){if(b.filter&&(f=!0,a.each(b.filter,function(a,b){if(!d[a].match(b))return f=!1}),!f))return;g.append('<li><p class="votes"><em>'+d.votes+'</em> votes</p><h3><a href="http://github.com/'+b.path+"/issues#issue/"+d.number+'">'+d.title+"</a></h3></li>");if(++h==b.limit)return!1});a("#github-voice p.call-to-action a").append("<span> ("+
c.issues.length+" ideas)</span>");a(this).trigger("github-voice-updatePosition")})}],updatePosition:[function(){this.bind("github-voice-updatePosition",function(){var b=a("#github-voice-wrapper");b.css("margin-top",-1*(b.height()/2))})}]};a.fn.githubVoice.defaults={sort:"votes",limit:5,overlay:!0,filter:null,text:{loading:"Loading...",description:"We've setup a feedback forum so you can tell us what's on your mind. Please go there and be heard!",callToAction:"&raquo; Go to our Feedback Forum"},html:'<div id="github-voice-wrapper"><div class="close" /><h1>Feedback</h1><div id="github-voice"><p class="description"></p><ol><li class="loading"></li></ol><p class="call-to-action"><a href="#"></a></p></div></div>'};
a.fn.setupExtras=a.fn.setupExtras||function(a,e){for(property in a)if(a[property]instanceof Array)for(var c=a[property].length,d=0;d<c;d++)a[property][d].call(this,e);else a[property].call(this,e);return this}})(jQuery);
