(function(b){b.fn.githubVoice=function(a,d,c){c=b.extend(true,{},b.fn.githubVoice.defaults,c||{});c.path=a+"/"+d;this.setupExtras(c.setup||b.fn.githubVoice.base,c);this.each(function(){b(this).trigger("github-voice-initialize")});return this};b.fn.githubVoice.base={initialize:[function(){this.bind("github-voice-initialize",function(){b(this).trigger("github-voice-bindEventListeners")})}],bindEventListeners:[function(a){this.bind("github-voice-bindEventListeners",function(){var d=b(this);d.click(function(){var c=
d.data("cache");a.overlay&&d.trigger("github-voice-createOverlay");d.trigger("github-voice-createElement").trigger("github-voice-updatePosition");c?d.trigger("github-voice-update",[c]):b.getJSON("http://github.com/api/v2/json/issues/list/"+(a.path+"/open")+"?callback=?",function(e){d.trigger("github-voice-update",[e]);d.data("cache",e)});return false})})}],createElement:[function(a){this.bind("github-voice-createElement",function(){b("body").append(a.html);b("#github-voice").find("p.description").html(a.text.description).end().find("li.loading").html(a.text.loading).end().find("p.call-to-action a").html(a.text.callToAction).attr("href",
"http://github.com/"+a.path+"/issues")})}],createOverlay:[function(){this.bind("github-voice-createOverlay",function(){b("body").append('<div id="github-voice-overlay"></div>').find("#github-voice-overlay").css({width:b(window).width(),height:b(document).height(),opacity:0.75}).click(function(){b("#github-voice-overlay, #github-voice-wrapper").remove()})})}],update:[function(a){this.bind("github-voice-update",function(d,c){var e=a.sort,i=b("#github-voice ol").empty(),j=0,g;c.issues.sort(b.isFunction(e)?
e:function(h,f){return h[e]<f[e]?1:h[e]>f[e]?-1:0});b.each(c.issues,function(h,f){if(a.filter){g=true;b.each(a.filter,function(k,l){if(!f[k].match(l))return g=false});if(!g)return}i.append('<li><p class="votes"><em>'+f.votes+'</em> votes</p><h3><a href="http://github.com/'+a.path+"/issues#issue/"+f.number+'">'+f.title+"</a></h3></li>");if(++j==a.limit)return false});b("#github-voice p.call-to-action a").append("<span> ("+c.issues.length+" ideas)</span>");b(this).trigger("github-voice-updatePosition")})}],
updatePosition:[function(){this.bind("github-voice-updatePosition",function(){var a=b("#github-voice-wrapper");a.css("margin-top",-1*(a.height()/2))})}]};b.fn.githubVoice.defaults={sort:"votes",limit:5,overlay:true,filter:null,text:{loading:"Loading...",description:"We've setup a feedback forum so you can tell us what's on your mind. Please go there and be heard!",callToAction:"&raquo; Go to our Feedback Forum"},html:'    <div id="github-voice-wrapper">       <h1>Feedback</h1>       <div id="github-voice">         <p class="description"></p>         <ol>           <li class="loading"></li>         </ol>         <p class="call-to-action"><a href="#"></a></p>       </div>     </div>'};
jQuery.fn.setupExtras=function(a,d){for(property in a){var c=this;if(a[property]instanceof Array)for(var e=0;e<a[property].length;e++)a[property][e].call(c,d);else a[property].call(c,d)}}})(jQuery);
