(function(a){a.fn.githubVoice=function(b,e,d){var c=a.fn.githubVoice,d=a.extend(true,{},c.defaults,d||{}),c=d.setup||c.base;d.path=b+"/"+e;for(property in c)for(var b=c[property],e=0,f=b.length;e<f;e++)b[e].call(this,d);return this.trigger("github-voice-initialize")};a.fn.githubVoice.base={initialize:[function(){this.bind("github-voice-initialize",function(){a(this).trigger("github-voice-bindEventListeners")})}],bindEventListeners:[function(b){var e="http://github.com/api/v2/json/issues/list/"+b.path+
"/open";this.bind("github-voice-bindEventListeners",function(){var d=a(this);d.click(function(){var c=d.data("cache");b.overlay&&d.trigger("github-voice-createOverlay");d.trigger("github-voice-createElement").trigger("github-voice-updatePosition");c?d.trigger("github-voice-update",[c]):a.getJSON(e+"?callback=?",function(a){d.data("cache",a).trigger("github-voice-update",[a])});return false})})}],createElement:[function(b){this.bind("github-voice-createElement",function(){var e=b.text;a("body").append(b.html);
a("#github-voice").find("p.description").html(e.description).end().find("li.loading").html(e.loading).end().find("p.call-to-action a").html(e.callToAction).attr("href","http://github.com/"+b.path+"/issues");a("#github-voice-wrapper .close").click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],createOverlay:[function(){this.bind("github-voice-createOverlay",function(){a("body").append('<div id="github-voice-overlay"></div>').find("#github-voice-overlay").css({width:a(window).width(),
height:a(document).height(),opacity:0.75}).click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],update:[function(b){this.bind("github-voice-update",function(e,d){var c=b.sort,f=a("#github-voice ol").empty(),h=0,g;d.issues.sort(a.isFunction(c)?c:function(a,b){return a[c]<b[c]?1:a[c]>b[c]?-1:0});a.each(d.issues,function(d,c){if(b.filter&&(g=true,a.each(b.filter,function(a,b){if(!c[a].match(b))return g=false}),!g))return;f.append('<li><p class="votes"><em>'+c.votes+'</em> votes</p><h3><a href="http://github.com/'+
b.path+"/issues#issue/"+c.number+'">'+c.title+"</a></h3></li>");if(++h==b.limit)return false});a("#github-voice p.call-to-action a").append("<span> ("+d.issues.length+" ideas)</span>");a(this).trigger("github-voice-updatePosition")})}],updatePosition:[function(){this.bind("github-voice-updatePosition",function(){var b=a("#github-voice-wrapper");b.css("margin-top",-1*(b.height()/2))})}]};a.fn.githubVoice.defaults={sort:"votes",limit:5,overlay:true,filter:null,text:{loading:"Loading...",description:"We've setup a feedback forum so you can tell us what's on your mind. Please go there and be heard!",
callToAction:"&raquo; Go to our Feedback Forum"},html:'<div id="github-voice-wrapper"><div class="close" /><h1>Feedback</h1><div id="github-voice"><p class="description"></p><ol><li class="loading"></li></ol><p class="call-to-action"><a href="#"></a></p></div></div>'}})(jQuery);
